<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="color-scheme" content="light">
    <title>mēgh</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Cpath fill='currentColor' d='M0 0v16h16V0H0zm14 14h-2v-4h-2v4H8v-2H6v2H2v-2h2v-2H2v-2h2V6H2V2h4v2h2V2h2v2h2v2h-2v2h2v4z'/%3E%3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;700&family=Montserrat:wght@400;600;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./index.css">
<link rel="stylesheet" href="/index.css">
</head>
<body class="flex items-center justify-center">
    
    <!-- Mobile Header -->
    <header id="mobile-header" class="lg:hidden fixed top-0 left-0 w-full flex justify-between items-center p-4 z-20">
        <h1 class="text-4xl font-bold main-title">mēgh</h1>
        <button id="openOptionsBtn" class="themed-button p-2 rounded-lg">Options</button>
    </header>

    <div class="flex flex-col items-center h-[100svh] w-screen p-4 lg:justify-center pt-20 lg:pt-4 pb-72 lg:pb-4">
        <!-- Desktop Title -->
        <div class="hidden lg:flex flex-col items-center justify-center mb-6 text-center max-w-full">
            <h1 class="text-6xl md:text-8xl font-bold main-title whitespace-nowrap">mēgh</h1>
            <h2 class="text-lg md:text-xl mt-2 main-title-sub italic">a floating piece of water in the sky</h2>
        </div>
        
        <main class="w-full max-w-5xl mx-auto flex-grow flex items-center">
             <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 items-center lg:items-start w-full">
                <!-- Maze Canvas -->
                <div id="canvas-container" class="themed-panel rounded-lg w-full lg:col-span-2 relative order-2 lg:order-1">
                    <canvas id="mazeCanvas" class="w-full h-auto block rounded-lg"></canvas>
                    <div id="game-start-overlay" class="absolute inset-0 flex items-center justify-center pointer-events-none">
                        <span id="game-start-text" class="text-6xl md:text-8xl font-bold main-title"></span>
                    </div>
                </div>

                <!-- Stats and Controls Panel -->
                <div class="flex flex-col items-center justify-center space-y-6 w-full order-1 lg:order-2 lg:mt-0">
                    <div id="stats-panel" class="themed-panel rounded-lg w-full p-4 md:p-6 text-center">
                        <div class="flex justify-between items-center mb-3">
                            <h2 class="text-2xl md:text-3xl font-bold main-title">Stats & Info</h2>
                             <button id="sound-toggle-btn" class="themed-button p-2 rounded-lg" aria-label="Toggle sound">
                                <!-- SVG will be injected by JS -->
                            </button>
                        </div>
                        
                        <div class="flex justify-center border-2 border-gray-700 rounded-lg mb-3">
                            <button id="dailyModeBtn" class="w-1/2 p-2 themed-button rounded-l-md active-mode">Daily</button>
                            <button id="endlessModeBtn" class="w-1/2 p-2 themed-button rounded-r-md">Endless</button>
                        </div>

                        <div class="grid grid-cols-2 gap-4 text-center mb-3">
                            <div>
                                <p class="stats-label">TIME</p>
                                <p id="timer" class="stats-value text-lg">00:00.0</p>
                            </div>
                            <div id="score-attempts-container">
                                 <p id="score-attempts-label" class="stats-label">ATTEMPTS</p>
                                 <p id="score-attempts-value" class="stats-value text-lg">3</p>
                            </div>
                        </div>
                        <p id="comebackMessage" class="text-md text-gray-700 hidden">Come back tomorrow for a new puzzle!</p>
                    </div>

                    <div class="hidden lg:grid grid-cols-2 gap-4 w-full">
                        <button id="newMazeBtn" class="themed-button font-bold py-2 px-4 rounded-lg">New Maze</button>
                        <button id="statsBtn" class="themed-button font-bold py-2 px-4 rounded-lg">Statistics</button>
                        <button id="themeBtn" class="themed-button font-bold py-2 px-4 rounded-lg">Change Theme</button>
                        <button id="aboutBtn" class="themed-button font-bold py-2 px-4 rounded-lg">About</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Mobile D-Pad -->
    <div id="dpad-controls">
        <button id="dpad-up" class="dpad-btn" aria-label="Move up">▲</button>
        <button id="dpad-left" class="dpad-btn" aria-label="Move left">◀</button>
        <button id="dpad-right" class="dpad-btn" aria-label="Move right">▶</button>
        <button id="dpad-down" class="dpad-btn" aria-label="Move down">▼</button>
    </div>


    <!-- Reusable Theme Preview Template -->
    <template id="theme-preview-template">
        <div class="theme-preview-container" role="button" tabindex="0">
            <div class="preview-bg">
                <div class="preview-wall"></div>
                <div class="preview-player"></div>
                <div class="preview-goal"></div>
            </div>
            <p class="theme-name"></p>
        </div>
    </template>

    <!-- Mobile Options Modal -->
    <div id="optionsModal" role="dialog" aria-modal="true" aria-labelledby="optionsModalTitle" class="modal hidden absolute top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-75 z-50">
        <div class="message-box p-8 rounded-lg max-w-sm w-11/12 relative">
             <button id="closeOptionsBtn" aria-label="Close options" class="absolute top-2 right-3 text-3xl font-bold">&times;</button>
            <h2 id="optionsModalTitle" class="text-4xl font-bold mb-6 text-center main-title">Options</h2>
            <div class="grid grid-cols-1 gap-4 w-full">
                <button id="newMazeBtnMobile" class="themed-button font-bold py-3 px-4 rounded-lg">New Maze</button>
                <button id="statsBtnMobile" class="themed-button font-bold py-3 px-4 rounded-lg">Statistics</button>
                <button id="themeBtnMobile" class="themed-button font-bold py-3 px-4 rounded-lg">Change Theme</button>
                <button id="aboutBtnMobile" class="themed-button font-bold py-3 px-4 rounded-lg">About</button>
            </div>
        </div>
    </div>

    <!-- Instructions Box -->
    <div id="instructions" role="dialog" aria-modal="true" aria-labelledby="instructionsTitle" class="modal hidden absolute top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-75 z-50">
        <div class="message-box text-center p-8 rounded-lg max-w-lg w-11/12">
            <h2 id="instructionsTitle" class="text-4xl font-bold mb-4 main-title">Welcome to mēgh</h2>
            <p class="text-lg mb-6">A daily puzzle to test your pathfinding skills.</p>
            
            <h3 class="text-2xl font-bold mb-3 main-title">Choose Your Theme</h3>
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-8" data-theme-grid>
                <!-- Theme previews will be populated by JS -->
            </div>

            <button id="startBtn" class="themed-button font-bold py-3 px-6 rounded-lg text-xl">Start</button>
        </div>
    </div>
    
    <!-- Theme Modal -->
    <div id="themeModal" role="dialog" aria-modal="true" aria-labelledby="themeModalTitle" class="modal hidden absolute top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-75 z-50">
        <div class="message-box text-center p-8 rounded-lg max-w-lg w-11/12 relative">
            <button id="closeThemeBtn" aria-label="Close theme selection" class="absolute top-2 right-3 text-3xl font-bold">&times;</button>
            <h2 id="themeModalTitle" class="text-4xl font-bold mb-6 main-title">Change Theme</h2>
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-4" data-theme-grid>
                <!-- Theme previews will be populated by JS -->
            </div>
        </div>
    </div>

    <!-- Password Modal -->
    <div id="passwordModal" role="dialog" aria-modal="true" aria-labelledby="passwordModalTitle" class="modal hidden absolute top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-75 z-50">
        <div class="message-box text-center p-8 rounded-lg max-w-sm w-11/12">
            <h2 id="passwordModalTitle" class="text-3xl font-bold mb-4 main-title">Enter Passcode</h2>
            <input type="password" id="passwordInput" class="password-input w-full p-2 rounded-lg text-center mb-4">
            <div class="flex justify-center space-x-4">
                <button id="passwordCancel" class="themed-button font-bold py-2 px-6 rounded-lg">Cancel</button>
                <button id="passwordSubmit" class="themed-button font-bold py-2 px-6 rounded-lg">Enter</button>
            </div>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div id="confirmModal" role="dialog" aria-modal="true" aria-labelledby="confirmModalTitle" class="modal hidden absolute top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-75 z-50">
        <div class="message-box text-center p-8 rounded-lg max-w-sm w-11/12">
            <h2 id="confirmModalTitle" class="text-3xl font-bold mb-4 main-title">Are you sure?</h2>
            <p id="confirmModalText" class="text-lg mb-6">Your current progress will be lost.</p>
            <div class="flex justify-center space-x-4">
                <button id="confirmCancel" class="themed-button font-bold py-2 px-6 rounded-lg">Cancel</button>
                <button id="confirmSubmit" class="themed-button font-bold py-2 px-6 rounded-lg">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Win Message Box -->
    <div id="winMessage" role="dialog" aria-modal="true" aria-labelledby="winTitle" class="modal hidden absolute top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-50 z-50">
        <div class="message-box text-center p-8 rounded-lg max-w-md w-11/12">
            <h2 id="winTitle" class="text-5xl font-bold mb-4 main-title">PATH COMPLETE</h2>
            <p id="statsText" class="text-lg mb-6">You have found the end.</p>
            <div id="buttonContainer" class="flex flex-col sm:flex-row items-center justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                 <!-- Buttons will be injected here -->
            </div>
        </div>
    </div>
    
    <!-- Stats Modal -->
    <div id="statsModal" role="dialog" aria-modal="true" aria-labelledby="statsModalTitle" class="modal hidden absolute top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-75 z-50">
        <div class="message-box p-8 rounded-lg max-w-lg w-full relative">
            <button id="closeStatsBtn" aria-label="Close statistics" class="absolute top-2 right-3 text-3xl font-bold">&times;</button>
            <h2 id="statsModalTitle" class="text-4xl font-bold mb-6 text-center main-title">Statistics</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center mb-6">
                <div>
                    <p id="stat-current-streak" class="stats-value">0</p>
                    <p id="stat-label-current-streak" class="stats-label text-sm">Current Streak</p>
                </div>
                <div>
                    <p id="stat-max-streak" class="stats-value">0</p>
                    <p id="stat-label-max-streak" class="stats-label text-sm">Max Streak</p>
                </div>
                <div>
                    <p id="stat-puzzles-solved" class="stats-value">0</p>
                    <p id="stat-label-puzzles-solved" class="stats-label text-sm">Puzzles Solved</p>
                </div>
                <div>
                    <p id="stat-avg-time" class="stats-value">--:--</p>
                    <p id="stat-label-avg-time" class="stats-label text-sm">Average Time</p>
                </div>
            </div>
            <h3 class="text-2xl font-bold mb-4 text-center main-title">Recent Times</h3>
            <div id="stats-graph" class="graph-container flex items-end justify-around h-40 gap-2">
                <!-- Graph bars will be injected here -->
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div id="aboutModal" role="dialog" aria-modal="true" aria-labelledby="aboutModalTitle" class="modal hidden absolute top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-75 z-50">
        <div class="message-box text-center p-8 rounded-lg max-w-lg w-11/12 relative">
            <button id="closeAboutBtn" aria-label="Close about" class="absolute top-2 right-3 text-3xl font-bold">&times;</button>
            <h2 id="aboutModalTitle" class="text-4xl font-bold mb-4 main-title">About mēgh</h2>
            <p class="text-lg mb-4">mēgh was created as an exploration of generative art, game design, and human-AI collaboration.</p>
            <p class="text-lg mb-6">It is a small puzzle, a quiet moment, a path to find.</p>
            <p class="italic text-base opacity-80">May you find your path.</p>
        </div>
    </div>

    <!-- Debug Overlay -->
    <div id="debug-overlay"></div>

    <script type="module" src="./index.js"></script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
