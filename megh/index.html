<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>mēgh</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Cpath fill='currentColor' d='M0 0v16h16V0H0zm14 14h-2v-4h-2v4H8v-2H6v2H2v-2h2v-2H2v-2h2V6H2V2h4v2h2V2h2v2h2v2h-2v2h2v4z'/%3E%3C/svg%3E">
    <link rel="manifest" href="/megh/manifest.json">
    <meta name="theme-color" content="#10111A">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODAgMTgwIj4KICA8cmVjdCB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgcng9IjQwIiBmaWxsPSIjMTAxMTFBIi8+CiAgPHBhdGggZmlsbD0iI0ZGRjIwMCIgZD0iTTQwIDQwIFYgMTAwIEggNTUgViA1NSBIIDEwMCBWIDQwIEggNDAgWiBNIDcwIDcwIFYgMTQwIEggODUgViA4NSBIIDE0MCBWIDcwIEggNzAgWiIvPgo8L3N2Zz4=">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;700&family=Montserrat:wght@400;600;700&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/megh/index.css">
<link rel="stylesheet" href="/index.css">
</head>
<body class="flex flex-col h-screen w-screen overflow-hidden">

    <!-- Mobile Header -->
    <header id="mobile-header" class="lg:hidden fixed top-0 left-0 w-full flex justify-between items-center p-4 z-20 backdrop-blur-md" style="background-color: var(--panel-bg-color);">
        <h1 class="text-3xl font-bold main-title">mēgh</h1>
        <div class="flex items-center space-x-4">
             <div class="text-center w-20">
                 <p class="stats-label">Time</p>
                 <p id="timer-mobile" class="stats-value">00:00.0</p>
             </div>
             <div id="score-attempts-container-mobile" class="text-center w-20">
                  <p id="score-attempts-label-mobile" class="stats-label">Attempts</p>
                  <p id="score-attempts-value-mobile" class="stats-value">3</p>
             </div>
        </div>
        <button id="openOptionsBtn" class="themed-button p-2 rounded-lg">Options</button>
    </header>

    <!-- Desktop Header -->
    <header id="desktop-header" class="hidden lg:flex w-full max-w-7xl mx-auto p-4 items-center justify-between">
        <div class="flex items-baseline space-x-4">
            <h1 class="text-5xl main-title">mēgh</h1>
            <h2 class="text-lg main-title-sub italic">a floating piece of <span class="text-highlight">water</span> in the sky</h2>
        </div>
        <div class="flex items-center space-x-4">
            <!-- Mode Switcher -->
            <div class="flex justify-center border-2 border-gray-700 rounded-lg">
                <button id="dailyModeBtn" class="p-2 px-4 themed-button rounded-l-md active-mode">Daily</button>
                <button id="endlessModeBtn" class="p-2 px-4 themed-button rounded-r-md">Endless</button>
            </div>
            <!-- Stats -->
            <div class="flex items-center space-x-4 themed-panel p-2 px-4 rounded-lg">
                <div class="text-center w-24">
                    <p class="stats-label">TIME</p>
                    <p id="timer" class="stats-value">00:00.0</p>
                </div>
                <div id="score-attempts-container" class="text-center w-24">
                     <p id="score-attempts-label" class="stats-label">ATTEMPTS</p>
                     <p id="score-attempts-value" class="stats-value">3</p>
                </div>
            </div>
            <p id="comebackMessage" class="text-md text-gray-700 hidden">Come back tomorrow for a new puzzle!</p>
            <!-- Controls -->
            <div class="flex items-center space-x-2">
                <button id="newMazeBtn" class="themed-button font-bold rounded-lg">Restart</button>
                <button id="statsBtn" class="themed-button font-bold rounded-lg">Statistics</button>
                <button id="aboutBtn" class="themed-button font-bold rounded-lg">About</button>
                <button class="themed-button p-2 rounded-lg js-sound-toggle" aria-label="Toggle sound"></button>
            </div>
        </div>
    </header>

    <div class="flex flex-col items-center w-full flex-grow min-h-0 p-4 justify-start lg:justify-start pt-16 lg:pt-8 pb-8 lg:pb-4">
        <main class="w-full max-w-5xl mx-auto flex-grow flex items-center justify-center">
             <div id="canvas-container" class="themed-panel rounded-lg w-full max-w-lg relative">
                <canvas id="mazeCanvas" class="w-full h-full block rounded-lg"></canvas>
                <canvas id="particleCanvas" class="absolute top-0 left-0 w-full h-full block pointer-events-none rounded-lg"></canvas>
                <div id="game-start-overlay" class="absolute inset-0 flex items-center justify-center pointer-events-none">
                    <span id="game-start-text" class="text-4xl md:text-5xl font-bold main-title text-center px-4"></span>
                </div>
                <div id="onboarding-hint">Find the pulsing goal.</div>
                 <!-- Onboarding Tutorial -->
                <div id="onboarding-tutorial" class="absolute inset-0 bg-black bg-opacity-70 backdrop-blur-sm z-50 flex-col items-center justify-center p-8 text-center hidden">
                    <div id="onboarding-spotlight" class="absolute rounded-full pointer-events-none" style="box-shadow: 0 0 0 9999px rgba(0,0,0,0.7);"></div>
                    <div id="onboarding-text-container" class="relative z-10 text-white">
                         <p id="onboarding-text" class="text-2xl mb-8"></p>
                         <button id="onboarding-next-btn" class="themed-button font-bold py-3 px-6 rounded-lg text-xl">Got it!</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Mobile Options Modal -->
    <div id="optionsModal" role="dialog" aria-modal="true" aria-labelledby="optionsModalTitle" class="modal hidden absolute top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-75 z-50">
        <div class="message-box p-8 rounded-lg max-w-sm w-11/12 relative">
            <button id="closeOptionsBtn" aria-label="Close options" class="absolute top-2 right-3 text-3xl font-bold">&times;</button>
            <h2 id="optionsModalTitle" class="text-4xl font-bold mb-6 text-center main-title">Options</h2>
            <div class="flex justify-between items-center mb-6">
                <div class="flex justify-center border-2 border-gray-700 rounded-lg w-2/3">
                    <button id="dailyModeBtnMobile" class="w-1/2 p-2 themed-button rounded-l-md active-mode">Daily</button>
                    <button id="endlessModeBtnMobile" class="w-1/2 p-2 themed-button rounded-r-md">Endless</button>
                </div>
                 <button class="themed-button p-2 rounded-lg js-sound-toggle" aria-label="Toggle sound"></button>
             </div>
            <div class="grid grid-cols-1 gap-4 w-full">
                <button id="newMazeBtnMobile" class="themed-button font-bold py-3 px-4 rounded-lg">New Maze</button>
                <button id="statsBtnMobile" class="themed-button font-bold py-3 px-4 rounded-lg">Statistics</button>
                <button id="aboutBtnMobile" class="themed-button font-bold py-3 px-4 rounded-lg">About</button>
            </div>
        </div>
    </div>
    
    <!-- Password Modal -->
    <div id="passwordModal" role="dialog" aria-modal="true" aria-labelledby="passwordModalTitle" class="modal hidden absolute top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-75 z-50">
        <div class="message-box text-center p-8 rounded-lg max-w-sm w-11/12">
            <h2 id="passwordModalTitle" class="text-3xl font-bold mb-4 main-title">Enter Passcode</h2>
            <input type="password" id="passwordInput" class="password-input w-full p-2 rounded-lg text-center mb-4">
            <div class="flex justify-center space-x-4">
                <button id="passwordCancel" class="themed-button font-bold py-2 px-6 rounded-lg">Cancel</button>
                <button id="passwordSubmit" class="themed-button font-bold py-2 px-6 rounded-lg">Enter</button>
            </div>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div id="confirmModal" role="dialog" aria-modal="true" aria-labelledby="confirmModalTitle" class="modal hidden absolute top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-75 z-50">
        <div class="message-box text-center p-8 rounded-lg max-w-sm w-11/12">
            <h2 id="confirmModalTitle" class="text-3xl font-bold mb-4 main-title">Are you sure?</h2>
            <p id="confirmModalText" class="text-lg mb-6">Your current progress will be lost.</p>
            <div class="flex justify-center space-x-4">
                <button id="confirmCancel" class="themed-button font-bold py-2 px-6 rounded-lg">Cancel</button>
                <button id="confirmSubmit" class="themed-button font-bold py-2 px-6 rounded-lg">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Win Message Box -->
    <div id="winMessage" role="dialog" aria-modal="true" aria-labelledby="winTitle" class="modal hidden absolute top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-50 z-50">
        <div class="message-box text-center p-8 rounded-lg max-w-md w-11/12">
            <h2 id="winTitle" class="text-5xl font-bold mb-4 main-title">PATH COMPLETE</h2>
            <p id="statsText" class="text-lg mb-6 user-selectable">You have found the end.</p>
            <div id="buttonContainer" class="flex flex-col sm:flex-row items-center justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                 <!-- Buttons will be injected here -->
            </div>
        </div>
    </div>
    
    <!-- Stats Modal -->
    <div id="statsModal" role="dialog" aria-modal="true" aria-labelledby="statsModalTitle" class="modal hidden absolute top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-75 z-50">
        <div class="message-box p-8 rounded-lg max-w-lg w-full relative">
            <button id="closeStatsBtn" aria-label="Close statistics" class="absolute top-2 right-3 text-3xl font-bold">&times;</button>
            <h2 id="statsModalTitle" class="text-4xl font-bold mb-6 text-center main-title">Statistics</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center mb-6">
                <div>
                    <p id="stat-current-streak" class="stats-value">0</p>
                    <p id="stat-label-current-streak" class="stats-label text-sm">Current Streak</p>
                </div>
                <div>
                    <p id="stat-max-streak" class="stats-value">0</p>
                    <p id="stat-label-max-streak" class="stats-label text-sm">Max Streak</p>
                </div>
                <div>
                    <p id="stat-puzzles-solved" class="stats-value">0</p>
                    <p id="stat-label-puzzles-solved" class="stats-label text-sm">Puzzles Solved</p>
                </div>
                <div>
                    <p id="stat-avg-time" class="stats-value">--:--</p>
                    <p id="stat-label-avg-time" class="stats-label text-sm">Average Time</p>
                </div>
            </div>
            <h3 class="text-2xl font-bold mb-4 text-center main-title">Recent Times</h3>
            <div id="stats-graph" class="graph-container flex items-end justify-around h-40 gap-2">
                <!-- Graph bars will be injected here -->
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div id="aboutModal" role="dialog" aria-modal="true" aria-labelledby="aboutModalTitle" class="modal hidden absolute top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-75 z-50">
        <div class="message-box text-center p-8 rounded-lg max-w-lg w-11/12 relative">
            <button id="closeAboutBtn" aria-label="Close about" class="absolute top-2 right-3 text-3xl font-bold">&times;</button>
            <h2 id="aboutModalTitle" class="text-4xl font-bold mb-4 main-title">About mēgh</h2>
            <p class="text-lg mb-4 user-selectable">mēgh was created as an exploration of generative art, game design, and human-AI collaboration.</p>
            <p class="text-lg mb-6 user-selectable">It is a small puzzle, a quiet moment, a path to find.</p>
            <p class="italic text-base opacity-80 user-selectable">May you find your path.</p>
        </div>
    </div>

    <!-- Debug Overlay -->
    <div id="debug-overlay"></div>

    <!-- Decorative Background Elements -->
    <div class="sparkle-container" aria-hidden="true">
        <div class="sparkle"></div>
        <div class="sparkle"></div>
        <div class="sparkle"></div>
        <div class="sparkle"></div>
        <div class="sparkle"></div>
        <div class="sparkle"></div>
    </div>
    <div id="decorative-text" aria-hidden="true">
        <span class="absolute top-[20%] left-[5%] text-[10vw] lg:text-8xl opacity-5 font-serif">sanskrit</span>
        <span class="absolute bottom-[20%] right-[5%] text-[15vw] lg:text-9xl opacity-5 font-serif">मेघ</span>
    </div>

    <script type="module" src="/megh/index.js"></script>
<script type="module" src="/index.tsx"></script>
</body>
</html>