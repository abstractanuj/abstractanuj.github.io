<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Writing | Anuj Singh</title>
    <!-- Import Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        /* RESET & BASE */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --bg-color: #ffffff;
            --text-color: #111111;
            --secondary-text: #555555;
            --link-color: #0044CC;
            --spacing-unit: 1.5rem;
            --font-main: "Inter", sans-serif;
            --font-mono: "JetBrains Mono", monospace;
            
            /* Standardized Type Scale */
            --size-xs: 0.75rem;   /* 12px */
            --size-sm: 0.875rem;  /* 14px */
            --size-base: 1rem;    /* 16px */
            --size-md: 1.125rem;  /* 18px */
            --size-lg: 1.5rem;    /* 24px */
            --size-xl: 2.5rem;    /* 40px */
            --size-xxl: 4rem;     /* 64px */
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-main);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            padding: var(--spacing-unit);
            position: relative;
        }

        /* BACKGROUND ANIMATION */
        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        /* LINKS */
        a {
            color: var(--link-color);
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        a:hover {
            text-decoration: underline;
            text-underline-offset: 4px;
        }

        /* LAYOUT */
        .layout {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
            padding-top: 2rem;
        }

        /* NAVIGATION */
        .nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #000;
            padding-bottom: 1.5rem;
            margin-bottom: 2rem;
        }

        .home-link {
            font-family: var(--font-mono);
            font-weight: 500;
            font-size: var(--size-base);
            color: var(--text-color);
            text-decoration: none;
        }
        .home-link:hover { color: var(--link-color); }

        h1 {
            font-weight: 800;
            font-size: var(--size-xl);
            letter-spacing: -0.03em;
        }

        /* WRITING LIST */
        .writing-list {
            list-style: none;
        }

        .writing-item {
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            margin-bottom: 1.75rem;
        }

        .writing-left {
            display: flex;
            align-items: baseline;
            flex-grow: 1;
            padding-right: 2rem;
        }

        .writing-num {
            font-family: var(--font-mono);
            font-size: var(--size-sm);
            margin-right: 1rem;
            color: #aaa;
            min-width: 2ch;
            flex-shrink: 0;
        }

        .writing-title {
            font-size: var(--size-lg);
            font-weight: 400;
            line-height: 1.4;
            display: block;
        }
        
        .writing-date {
            font-family: var(--font-mono);
            font-size: var(--size-xs);
            color: var(--secondary-text);
            white-space: nowrap;
            flex-shrink: 0;
        }

        /* POST VIEWER */
        #post-viewer {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        #post-viewer.active {
            display: block;
            opacity: 1;
        }

        #post-list-container {
            transition: opacity 0.3s ease;
        }

        #post-list-container.hidden {
            display: none;
        }

        /* AESTHETIC CONTROLS */
        .controls-bar {
            display: flex;
            justify-content: flex-end; /* Changed to flex-end because back button is removed */
            align-items: center;
            margin-bottom: 2rem;
            position: sticky;
            top: 1rem;
            z-index: 100;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(5px);
            padding: 0.5rem 0;
        }

        .share-btn {
            background: transparent;
            color: var(--link-color);
            border: 1px solid var(--link-color);
            padding: 6px 16px;
            border-radius: 20px;
            font-family: var(--font-mono);
            font-size: var(--size-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .share-btn:hover {
            background: var(--link-color);
            color: #fff;
        }

        /* POST STYLING (Inherited mostly, refined for reading) */
        .post-page-header {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .post-page-header h1 {
            font-size: var(--size-xl);
            margin-bottom: 1rem;
        }

        .post-page-meta {
            font-family: var(--font-mono);
            color: var(--secondary-text);
            font-size: var(--size-sm);
        }

        .post-page-content p {
            font-size: var(--size-md);
            line-height: 1.7;
            margin-bottom: 1.5rem;
            color: #222;
        }

        .post-page-content ul {
            list-style: disc;
            padding-left: 1.5rem;
            margin-bottom: 2rem;
        }

        .post-page-content li {
            margin-bottom: 1rem;
            font-size: var(--size-base);
            line-height: 1.6;
        }

        @media (min-width: 768px) {
            .layout {
                padding-top: 4rem;
            }
            h1 {
                font-size: 3rem;
            }
        }
    </style>
</head>
<body>
    <canvas id="bg-canvas"></canvas>
    
    <div class="layout">
        <!-- Navigation Header -->
        <nav class="nav-header">
            <h1>Writing</h1>
            <a href="index.html" class="home-link">‚Üê Anuj Singh</a>
        </nav>

        <!-- List View -->
        <div id="post-list-container">
            <ul class="writing-list" id="writing-list">
                <!-- Items injected via JS -->
            </ul>
        </div>

        <!-- Single Post View -->
        <div id="post-viewer">
            <div class="controls-bar">
                <button class="share-btn" id="share-post-btn">
                    Share 
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
                    </svg>
                </button>
            </div>
            <div id="post-content-area">
                <!-- Content Loaded Here -->
            </div>
        </div>
    </div>

    <script>
        // Post Configuration - Automatic Fetching requires knowing files exist
        const posts = [
            {
                id: 'anuga',
                title: "Impressions from ANUGA FoodTec '24",
                date: "Aug 25, 2024",
                file: 'writings/anuga.html'
            },
            {
                id: 'atom',
                title: "On the Nature of the Atom",
                date: "Aug 18, 2024",
                file: 'writings/atom.html'
            },
            {
                id: 'indigenous',
                title: "The Case for Indigenous Technology",
                date: "Aug 11, 2024",
                file: 'writings/indigenous.html'
            },
            {
                id: 'knox',
                title: "Bypassing Samsung's Knox Security",
                date: "Aug 04, 2024",
                file: 'writings/knox.html'
            }
        ];

        const listContainer = document.getElementById('writing-list');
        const listWrapper = document.getElementById('post-list-container');
        const viewer = document.getElementById('post-viewer');
        const contentArea = document.getElementById('post-content-area');
        const shareBtn = document.getElementById('share-post-btn');

        let currentPostTitle = "";

        // 1. Render List
        posts.forEach((post, index) => {
            const li = document.createElement('li');
            li.className = 'writing-item';
            
            // Left Container for Number and Title
            const leftDiv = document.createElement('div');
            leftDiv.className = 'writing-left';

            const num = document.createElement('span');
            num.className = 'writing-num';
            num.textContent = `0${index + 1}.`;

            const link = document.createElement('a');
            link.className = 'writing-title';
            link.href = `#${post.id}`; // Updates URL hash
            link.textContent = post.title;
            
            link.addEventListener('click', (e) => {
                // Allow default behavior to update hash
                loadPost(post);
            });
            
            leftDiv.appendChild(num);
            leftDiv.appendChild(link);

            // Date on the right
            const dateSpan = document.createElement('span');
            dateSpan.className = 'writing-date';
            dateSpan.textContent = post.date;

            li.appendChild(leftDiv);
            li.appendChild(dateSpan);
            listContainer.appendChild(li);
        });

        // 2. Load Post Function
        async function loadPost(post) {
            listWrapper.classList.add('hidden');
            viewer.classList.add('active');
            contentArea.innerHTML = '<p style="text-align:center; color:#777; font-family:var(--font-mono)">Loading...</p>';
            currentPostTitle = post.title;

            try {
                const response = await fetch(post.file);
                if (!response.ok) throw new Error("Failed to load");
                const html = await response.text();
                contentArea.innerHTML = html;
                window.scrollTo(0,0);
            } catch (err) {
                contentArea.innerHTML = '<p>Error loading article. Ensure local server is running if testing locally.</p>';
            }
        }

        // 3. Close Post
        function closePost() {
            viewer.classList.remove('active');
            listWrapper.classList.remove('hidden');
            history.pushState("", document.title, window.location.pathname + window.location.search);
        }

        // 4. Handle Back Button/Hash Logic
        window.addEventListener('hashchange', () => {
            const hash = window.location.hash.substring(1);
            if (!hash) {
                closePost();
            } else {
                const post = posts.find(p => p.id === hash);
                if (post) loadPost(post);
            }
        });

        // Initial Load Check
        const initialHash = window.location.hash.substring(1);
        if (initialHash) {
            const post = posts.find(p => p.id === initialHash);
            if (post) loadPost(post);
        }

        // 5. Share Functionality
        shareBtn.addEventListener('click', async () => {
            const shareData = {
                title: currentPostTitle,
                text: `Read "${currentPostTitle}" by Anuj Singh`,
                url: window.location.href
            };

            if (navigator.share) {
                try {
                    await navigator.share(shareData);
                } catch (err) {
                    console.log('Share canceled');
                }
            } else {
                // Fallback
                try {
                    await navigator.clipboard.writeText(window.location.href);
                    const originalText = shareBtn.innerHTML;
                    shareBtn.textContent = "Copied!";
                    setTimeout(() => {
                        shareBtn.innerHTML = originalText;
                    }, 2000);
                } catch (err) {
                    alert('Could not copy link');
                }
            }
        });

        // BACKGROUND ANIMATION (Replicated for consistency)
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        let particlesArray = [];

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initParticles();
        }
        window.addEventListener('resize', resizeCanvas);

        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = 1.5;
                this.speedX = (Math.random() - 0.5) * 0.5;
                this.speedY = (Math.random() - 0.5) * 0.5;
                this.opacity = Math.random() * 0.5;
                this.fadeSpeed = 0.002 + Math.random() * 0.003;
                this.isFadingOut = Math.random() > 0.5;
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                if (this.x < 0) this.x = canvas.width;
                if (this.x > canvas.width) this.x = 0;
                if (this.y < 0) this.y = canvas.height;
                if (this.y > canvas.height) this.y = 0;

                if (this.isFadingOut) {
                    this.opacity -= this.fadeSpeed;
                    if (this.opacity <= 0) {
                        this.opacity = 0;
                        this.isFadingOut = false;
                        this.x = Math.random() * canvas.width;
                        this.y = Math.random() * canvas.height;
                    }
                } else {
                    this.opacity += this.fadeSpeed;
                    if (this.opacity >= 0.4) {
                        this.opacity = 0.4;
                        this.isFadingOut = true;
                    }
                }
            }
            draw() {
                ctx.fillStyle = `rgba(0, 68, 204, ${this.opacity})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function initParticles() {
            particlesArray = [];
            // Lower density (higher divisor)
            const numberOfParticles = Math.floor((canvas.width * canvas.height) / 12000); 
            for (let i = 0; i < numberOfParticles; i++) {
                particlesArray.push(new Particle());
            }
        }

        function animateParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < particlesArray.length; i++) {
                particlesArray[i].update();
                particlesArray[i].draw();
            }
            requestAnimationFrame(animateParticles);
        }

        resizeCanvas();
        animateParticles();
    </script>
</body>
</html>